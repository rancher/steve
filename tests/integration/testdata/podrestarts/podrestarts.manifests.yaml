apiVersion: v1
kind: Namespace
metadata:
  name: test-restarts
---
# Pod with no restarts - stable
apiVersion: v1
kind: Pod
metadata:
  name: stable-pod
  namespace: test-restarts
spec:
  containers:
  - name: busybox
    image: rancher/mirrored-library-busybox:1.36.1
    command: ["sleep", "infinity"]
  restartPolicy: Always
---
# Pod that will restart - exits once then stays running
# Uses an emptyDir volume to persist state across restarts
apiVersion: v1
kind: Pod
metadata:
  name: restarting-pod
  namespace: test-restarts
spec:
  volumes:
  - name: state
    emptyDir: {}
  containers:
  - name: busybox
    image: rancher/mirrored-library-busybox:1.36.1
    volumeMounts:
    - name: state
      mountPath: /state
    command: ["/bin/sh", "-c"]
    args:
      - |
        if [ ! -f /state/restarted ]; then
          touch /state/restarted
          exit 1
        fi
        sleep infinity
  restartPolicy: Always

