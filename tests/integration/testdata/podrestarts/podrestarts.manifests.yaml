apiVersion: v1
kind: Namespace
metadata:
  name: test-restarts
---
# Pod with no restarts - stable
apiVersion: v1
kind: Pod
metadata:
  name: stable-pod
  namespace: test-restarts
spec:
  containers:
  - name: nginx
    image: nginx:stable-alpine
  restartPolicy: Always
---
# Pod that will restart once
apiVersion: v1
kind: Pod
metadata:
  name: single-restart-pod
  namespace: test-restarts
spec:
  containers:
  - name: busybox
    image: busybox:latest
    command: ["/bin/sh", "-c"]
    args:
      - |
        if [ ! -f /tmp/restarted ]; then
          touch /tmp/restarted
          exit 1
        fi
        sleep infinity
  restartPolicy: Always
---
# Pod that will restart multiple times
apiVersion: v1
kind: Pod
metadata:
  name: multiple-restart-pod
  namespace: test-restarts
spec:
  containers:
  - name: busybox
    image: busybox:latest
    command: ["/bin/sh", "-c"]
    args:
      - |
        COUNT_FILE=/tmp/restart_count
        if [ ! -f $COUNT_FILE ]; then
          echo "0" > $COUNT_FILE
        fi
        COUNT=$(cat $COUNT_FILE)
        COUNT=$((COUNT + 1))
        echo $COUNT > $COUNT_FILE
        if [ $COUNT -lt 3 ]; then
          echo "Restart attempt $COUNT, exiting..."
          exit 1
        fi
        echo "Restart attempt $COUNT, now stable"
        sleep infinity
  restartPolicy: Always
---
# Another stable pod for comparison
apiVersion: v1
kind: Pod
metadata:
  name: another-stable-pod
  namespace: test-restarts
spec:
  containers:
  - name: nginx
    image: nginx:stable-alpine
  restartPolicy: Always
---
# Pod with moderate restarts
apiVersion: v1
kind: Pod
metadata:
  name: moderate-restart-pod
  namespace: test-restarts
spec:
  containers:
  - name: busybox
    image: busybox:latest
    command: ["/bin/sh", "-c"]
    args:
      - |
        COUNT_FILE=/tmp/restart_count
        if [ ! -f $COUNT_FILE ]; then
          echo "0" > $COUNT_FILE
        fi
        COUNT=$(cat $COUNT_FILE)
        COUNT=$((COUNT + 1))
        echo $COUNT > $COUNT_FILE
        if [ $COUNT -lt 2 ]; then
          echo "Restart attempt $COUNT, exiting..."
          exit 1
        fi
        echo "Restart attempt $COUNT, now stable"
        sleep infinity
  restartPolicy: Always

